09 퍼시스트 볼륨(PV)과 퍼시스트 볼륨 클레임(PVC)
- 지금까지 디플로이먼트에는 데이터 없었는데
- 포드 내부에 데이터가 있어야 하면 어떻게 관리해야 할까?
    - 포드 삭제하면 데이터가 삭제되니까
- 호스트에 위치한 디렉터리를 각 포드와 공유함으로써 데이터를 공유하는 것이 가능하다
    - 근데, 이 방법이 적합하지 않을 수 있다고 합니다. 특정 노드에서만 데이터를 보관해 저장하면 포드가 다른 노드로 옮겨 졌을 때 해당 데이터를 사용할 수 없게 된다
    - 그래서 특정 노드를 지정해 그 노드에서만 특정 포드가 실해야 해야
      - 이에 대한 해결법이 퍼시스트 볼륨
- 퍼시스트 볼륨 : 워커 노드들이 네트워크 상에서 스토리지를 마운트해 영속적으로 데이터를 저장할 수 있는 볼륨
    - 포드에 장애가 나서 다른 노드로 옮겨가도 해당 노드에서 퍼시스트 볼륨에 네트워크로 연결해서 데이터 계속 사용 가능
    - 대표적인 예, NFS, AWS의 EBS(Elastic Block Store), Ceph, GlusterFS 등
 
## 9.1 로컬 볼륨: hostPath, emptyDir

- hostPath: 호스트와 볼륨을 공유하기 위해 사용
- emptyDir : 포드의 컨테이너 간의 볼륨을 공유하기 위해 사용

### 9.1.1 워커 노드의 로컬 디렉터리를 볼륨으로 사용 : hostPath

- 호스트의 디렉터리를 포드와 공유해 데이터를 저장

- volumes 에 볼륨의 정의하고 이를 containers 항목에 참조해 사용,
- 호스트의 /tmp 를 포드의 /etc/data에 마운트
- 일단 파드를 생성하고  kubectl apply -f hostpath-pod.yaml
- 포드 내부의 컨테이너 내부로 들어가 /etc/data 디렉터리에 파일을 생성하면
 `sudo kubectl exec -it hostpath-pod touch /etc/data/mydata`
→ 이해 한게 맞는지? 포드의 데이터를 hostPath 에 저장하는 겨 그 반대도 가능

- **포드 데이터가 노드의 hostPath에 저장됨**: 포드 내부의 데이터를 노드의 특정 경로에 저장할 수 있습니다.
- **노드의 hostPath 데이터를 포드에서 접근**: 노드의 특정 경로에 이미 있는 데이터를 포드 내부에서 접근할 수 있습니다.
### 9.1.2 포드 컨네이터 간 임시 데이터 공유 : emptyDir

- 외부 볼륨을 생성하는게 아니라
- 포드가 실행되는 도중에만 필요한 휘발성 데이터를 각 컨테이너가 함께 사용할 수 있도록 임시 저장 공간 생성
- 포드가 삭제되면 이도 삭제

## 9.2 네트워크 볼륨

- 별도 플러그인 설치 없이 다양한 종류의 네트워크 볼륨을 포드에 마운트 할 수 있다. aws의 ebs ..
- 해당 볼륨이 네트워크로 접근할 수 만 있으면 클러스터 내부, 외부, 어디에 존재해도 상관 없다
- 단, aws ebs 와 같은 클라우드 종속적인 볼륨을 사용하려면 aws 에서 쿠버네티스 클러스터를 생성할 때 특정 클라우드를 위한 옵션이 별도로 설정 돼 있어야 합니다
### 9.3.3 퍼시스트 볼륨을 선택하기 위한 조건 명시

- 조건 :
    - accessMode
        - 1: N 마운트 가능하려면 ReadWriteMany
    - 볼륨 크기
    - 단, 볼륨이 정말 그 속성을 가져서 가져오는 게 아니라 볼륨에 정의된 메타에 의해서
    - storageClassName
    - 라벨 셀렉터 이용 가능

### 9.3.4 퍼시스트 볼륨의 라이프사이클과 Reclaim Policy
Released 는 볼륨 사용이 끝났다는 것으로 다시 사용할 수 없지만 데이터는 남아 있어 퍼시스턴트 볼륨 다시 삭제뒤 생성하면 Available 될 것 

- reclaim policy fh 볼륨이 사용이 끝나더라도 어떻게 할지 정할 수 있음
    - retain, delete, recycle (데이터 삭제 후 available 상태로 만들어줌 )
